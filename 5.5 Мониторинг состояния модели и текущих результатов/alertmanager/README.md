# Alertmanager

## Полезные ссылки
- [Официальные образы в Docker Hub](https://hub.docker.com/r/prom/alertmanager)
- [Официальная документация](https://prometheus.io/docs/alerting/latest/alertmanager/)


## Запуск контейнера
```bash
docker run -p 9093:9093 \
--name alerts-container \
--network monitoring-net \
-v <локальный путь к настройкам>/alertmanager.yml:/etc/alertmanager/alertmanager.yml \
prom/alertmanager
```

## Описание команды докера
- Флаг `--name alerts-container` позволяет обращаться к контейнеру по имени, вместо IP-адреса, внутри виртуальной сети докера
- Флаг `--network monitoring-net` запускает контейнер внутри виртуальной сети докера. Благодаря этому контейнеры, запущенные в одной виртуальной сети, смогут видеть друг друга
- Флаг `-p 9093:9093` пробрасывает дефолтный 9093 порт алертменеджера наружу. Рекомендуется, в целях безопасности, изменить на нестандартный
- Флаг `-v <локальный путь к настройкам>/alertmanager.yml:/etc/alertmanager/alertmanager.yml` пробрасывает настройки алертменеджера внутрь контейнера

## Как подключить к Telegram
1. Необходимо создать нового бота через `BotFather (@BotFather)` с помощью команды `/newbot`
2. После создания бота, `BotFather` пришлёт токен бота. Его необходимо указать в [настройках](alertmanager.yml#L15) алертменеджера
3. Найдите бота и запустите его
4. Перейдите по ссылке `https://api.telegram.org/bot<токен_вашего_бота>/getUpdates`
5. Если видите `{"ok":true,"result":[]}`, то необходимо написать что-то боту
6. После этого снова пройдите по ссылке и найдите ключ `chat` и скопируйте оттуда его `id`
7. ID чата, в который будут отправляться уведомления необходимо указать в [настройках](alertmanager.yml#L16) алертменеджера